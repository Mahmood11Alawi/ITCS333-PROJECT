<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage News</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css">
    <link rel="stylesheet" href="../styles.css">
</head>
<body class="container">
    <header class="container">
        <nav>
            <a href="MainNews.html" class="button">Back to News</a>
            <h1>Manage News</h1>
            <a href="../index.html" class="button">üè† Home</a>
        </nav>
    </header>

    <main class="container">
        <h2>News List</h2>
        <table id="news-table" class="card">
            <thead>
                <tr>
                    <th class="title-column">Title</th>
                    <th class="date-column">Date</th>
                    <th class="actions-column">Actions</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>

        <h2>Add / Edit News</h2>
        <form id="news-form" class="add-news">
            <input type="text" id="news-title" placeholder="Title" required />
            <textarea id="news-body" placeholder="Body" required></textarea>
            <input type="date" id="news-date" required />
            <input type="file" id="news-image" accept="image/*" />
            <button class="button" type="submit">Save News</button>
        </form>
    </main>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const apiUrl = "Posts.json";
            const tableBody = document.querySelector("#news-table tbody");
            const form = document.querySelector("#news-form");
            const titleInput = document.getElementById("news-title");
            const bodyInput = document.getElementById("news-body");
            const dateInput = document.getElementById("news-date");
            const imageInput = document.getElementById("news-image");
            let data = [];
            let editingIndex = null;

            // Fetch news data from JSON file
            fetch(apiUrl)
                .then(response => response.json())
                .then(fetchedData => {
                    data = fetchedData;
                    renderTable();
                })
                .catch(error => console.error("Error fetching news:", error));

            // Render news table
            function renderTable() {
                tableBody.innerHTML = data.map((item, index) => `
                    <tr>
                        <td>
                            <img src="${item.image}" alt="${item.title}" class="news-thumb">
                            ${item.title}
                        </td>
                        <td>${item.date}</td>
                        <td>
                            <button class="button" onclick="editNews(${index})">Edit</button>
                            <button class="delete" onclick="deleteNews(${index})">Delete</button>
                        </td>
                    </tr>
                `).join("");
            }

            // Edit a news item
            window.editNews = (index) => {
                editingIndex = index;
                const newsItem = data[index];
                titleInput.value = newsItem.title;
                bodyInput.value = newsItem.body;
                dateInput.value = newsItem.date;
            };

            // Delete a news item
            window.deleteNews = (index) => {
                if (confirm("Are you sure you want to delete this news?")) {
                    data.splice(index, 1);
                    renderTable();
                    saveToJSON();
                }
            };

            // Handle form submission
            form.addEventListener("submit", (e) => {
                e.preventDefault();
                const newNews = {
                    title: titleInput.value,
                    body: bodyInput.value,
                    date: dateInput.value,
                    image: imageInput.files[0] ? imageInput.files[0].name : "News1.jpg",
                    comments: []
                };

                if (editingIndex !== null) {
                    data[editingIndex] = newNews;
                    editingIndex = null;
                } else {
                    newNews.id = data.length + 1;
                    data.push(newNews);
                }

                form.reset();
                renderTable();
                saveToJSON();
            });

            // Simulated save function
            function saveToJSON() {
                console.log("Updated Data:", JSON.stringify(data, null, 2));
            }
        });
    </script>
</body>
</html>